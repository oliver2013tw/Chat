<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
*{
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif
}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#020617,#020024,#0f172a);
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== Login ===== */
#login{
  display:flex;
  flex-direction:column;
  gap:20px;
  padding:32px;
  border-radius:24px;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(14px);
  box-shadow:0 20px 60px rgba(0,0,0,.4);
}

#login h1{
  margin:0;
  text-align:center;
  font-size:24px;
}

#login button{
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
  background:white;
  color:black;
}

/* ===== Chat ===== */
#chat{
  display:none;
  width:100%;
  max-width:420px;
  height:100vh;
  padding:12px;
  flex-direction:column;
}

#messages{
  flex:1;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.msg{
  padding:10px 14px;
  border-radius:14px;
  max-width:80%;
  background:rgba(255,255,255,.15);
}

.mine{
  align-self:flex-end;
  background:#2563eb;
}

.other{
  align-self:flex-start;
}

#inputBar{
  display:flex;
  gap:8px;
}

#inputBar input{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:none;
}

#inputBar button{
  padding:12px 16px;
  border-radius:12px;
  border:none;
}

/* ===== Modal ===== */
#modal{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(10px);
  z-index:9999;
}

#modalCard{
  background:rgba(255,255,255,.18);
  padding:24px;
  border-radius:20px;
  text-align:center;
  width:80%;
  max-width:300px;
}

#modalCard button{
  margin-top:16px;
  padding:10px 20px;
  border-radius:12px;
  border:none;
}
</style>
</head>

<body>

<!-- Login -->
<div id="login">
  <h1>Chat</h1>
  <button id="loginBtn">‰ΩøÁî® Google ÁôªÂÖ•</button>
</div>

<!-- Chat -->
<div id="chat">
  <div id="messages"></div>
  <div id="inputBar">
    <input id="msgInput" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ">
    <button id="sendBtn">ÈÄÅÂá∫</button>
  </div>
</div>

<!-- Modal -->
<div id="modal">
  <div id="modalCard">
    <div id="modalText">ÊèêÁ§∫</div>
    <button id="modalOk">Á¢∫ÂÆö</button>
  </div>
</div>

<script>
/* üî• Firebase Ë®≠ÂÆöÔºàÂè™ÊîπÈÄôË£°Ôºâ */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT"
});

/* ===== Init ===== */
const auth = firebase.auth();
const db = firebase.database();

const login = document.getElementById("login");
const chat  = document.getElementById("chat");

/* ===== Modal ===== */
const modal = document.getElementById("modal");
const modalText = document.getElementById("modalText");
document.getElementById("modalOk").onclick = () => {
  modal.style.display = "none";
};

function showModal(text){
  modalText.innerText = text;
  modal.style.display = "flex";
}

/* ===== Login ===== */
document.getElementById("loginBtn").onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  const mobile = /Mobi|Android|iPhone/i.test(navigator.userAgent);
  mobile ? auth.signInWithRedirect(provider)
         : auth.signInWithPopup(provider).catch(()=>{
             auth.signInWithRedirect(provider);
           });
};

/* ===== Auth StateÔºàÂîØ‰∏ÄÂàáÁï´Èù¢‰æÜÊ∫êÔºâ ===== */
auth.onAuthStateChanged(user=>{
  if(!user){
    login.style.display="flex";
    chat.style.display="none";
    return;
  }

  login.style.display="none";
  chat.style.display="flex";
  initChat(user);
});

/* ===== Chat ===== */
function initChat(user){
  const msgRef = db.ref("messages");
  const box = document.getElementById("messages");
  box.innerHTML = "";

  msgRef.limitToLast(50).on("child_added", snap => {
    const m = snap.val();
    const div = document.createElement("div");
    div.className = "msg " + (m.uid === user.uid ? "mine" : "other");
    div.innerText = m.text;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  });

  document.getElementById("sendBtn").onclick = () => {
    const text = msgInput.value.trim();
    if(!text) return;
    msgRef.push({ uid:user.uid, text });
    msgInput.value = "";
  };
}
</script>
</body>
</html>