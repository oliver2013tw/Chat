<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Chat Nova</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<style>
:root{
 --bg:#020617;
 --panel:rgba(255,255,255,.06);
 --border:rgba(255,255,255,.12);
 --primary:#6366f1;
 --text-dim:#94a3b8;
}

*{box-sizing:border-box}
html,body{
 margin:0;height:100%;
 background:var(--bg);
 color:white;
 font-family:Inter,sans-serif;
 overflow:hidden;
}

/* ===== ËÉåÊôØ ===== */
.bg{
 position:fixed;inset:0;
 background:
  radial-gradient(circle at 80% 10%,rgba(99,102,241,.18),transparent 45%),
  radial-gradient(circle at 20% 90%,rgba(56,189,248,.14),transparent 45%);
 z-index:-1;
}

/* ===== Loading ===== */
#loading{
 position:fixed;inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 background:var(--bg);
 z-index:9999;
}
.loader{
 width:46px;height:46px;
 border-radius:50%;
 border:4px solid rgba(255,255,255,.15);
 border-top-color:var(--primary);
 animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ===== ÁôªÂÖ• ===== */
#login{
 display:none;
 position:fixed;inset:0;
 align-items:center;
 justify-content:center;
}
.login-card{
 width:92%;max-width:420px;
 padding:48px 40px;
 border-radius:28px;
 background:var(--panel);
 backdrop-filter:blur(28px);
 border:1px solid var(--border);
 text-align:center;
}
.login-card h1{
 font-size:3rem;margin:0;
 letter-spacing:.08em;
}
.login-card p{
 margin:24px 0 36px;
 color:var(--text-dim);
}
.login-btn{
 width:100%;
 padding:16px;
 border:none;
 border-radius:100px;
 font-weight:700;
 background:white;
 color:black;
 cursor:pointer;
}

/* ===== ËÅäÂ§© ===== */
#chat{
 display:none;
 height:100%;
 flex-direction:column;
}

header{
 height:70px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:0 20px;
 border-bottom:1px solid var(--border);
 background:rgba(2,6,23,.8);
 backdrop-filter:blur(20px);
}

#messages{
 flex:1;
 padding:20px;
 overflow-y:auto;
 display:flex;
 flex-direction:column;
 gap:14px;
}

.msg{max-width:80%}
.me{align-self:flex-end;text-align:right}

.name{
 font-size:11px;
 color:var(--text-dim);
 margin-bottom:4px;
}
.bubble{
 padding:12px 18px;
 border-radius:20px;
 background:var(--panel);
 border:1px solid var(--border);
}
.me .bubble{
 background:var(--primary);
 border:none;
 border-bottom-right-radius:4px;
}

footer{
 height:78px;
 padding:10px 20px;
 display:flex;
 gap:10px;
 border-top:1px solid var(--border);
 background:rgba(2,6,23,.85);
}
input{
 flex:1;
 border-radius:18px;
 border:1px solid var(--border);
 background:rgba(255,255,255,.05);
 color:white;
 padding:0 14px;
 font-size:15px;
}
.send{
 width:46px;height:46px;
 border:none;
 border-radius:50%;
 background:var(--primary);
 color:white;
 display:flex;
 align-items:center;
 justify-content:center;
}
</style>
</head>

<body>
<div class="bg"></div>

<div id="loading"><div class="loader"></div></div>

<div id="login">
 <div class="login-card">
  <h1>CHAT</h1>
  <p id="loginText">ÁôªÂÖ•‰ª•ÈñãÂßãÂ∞çË©±</p>
  <button class="login-btn" onclick="login()">‰ΩøÁî® Google ÁôªÂÖ•</button>
 </div>
</div>

<div id="chat">
 <header>
  <strong>Chat Nova</strong>
  <span id="online" style="font-size:12px;color:var(--text-dim)">‚Äî</span>
 </header>
 <div id="messages"></div>
 <footer>
  <input id="msg" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ‚Ä¶">
  <button class="send" onclick="send()">
   <span class="material-icons-round">send</span>
  </button>
 </footer>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyA6VaL_I9s6Wm3RFjNP5iHxFLp4hgQhkpc",
 authDomain:"kreon-chat-web.firebaseapp.com",
 databaseURL:"https://kreon-chat-web-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"kreon-chat-web"
});

const auth=firebase.auth();
const db=firebase.database();

/* üîë ÈóúÈçµÔºöÊåÅ‰πÖÂåñ */
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

/* üîë Âº∑Âà∂ finalize redirect */
auth.getRedirectResult().finally(startAuth);

function startAuth(){
 auth.onAuthStateChanged(u=>{
  loading.style.display="none";

  if(!u){
   login.style.display="flex";
   chat.style.display="none";
   return;
  }

  login.style.display="none";
  chat.style.display="flex";
  init(u);
 });
}

function login(){
 loginText.innerText="Â∞éÂêë Google ‰∏≠‚Ä¶";
 const p=new firebase.auth.GoogleAuthProvider();
 /Mobi|Android/i.test(navigator.userAgent)
 ? auth.signInWithRedirect(p)
 : auth.signInWithPopup(p).catch(()=>auth.signInWithRedirect(p));
}

function init(u){
 const o=db.ref("online/"+u.uid);
 o.set(true); o.onDisconnect().remove();
 db.ref("online").on("value",s=>{
  online.innerText=s.numChildren()+" ‰∫∫Âú®Á∑ö";
 });

 messages.innerHTML="";
 db.ref("messages").limitToLast(50).on("child_added",s=>{
  const m=s.val();
  const d=document.createElement("div");
  d.className="msg "+(m.uid===u.uid?"me":"");
  d.innerHTML=`<div class="name">${m.name}</div><div class="bubble">${m.text}</div>`;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
 });
}

function send(){
 if(!msg.value.trim())return;
 db.ref("messages").push({
  uid:auth.currentUser.uid,
  name:auth.currentUser.displayName,
  text:msg.value,
  time:Date.now()
 });
 msg.value="";
}
</script>
</body>
</html>